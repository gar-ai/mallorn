# cbindgen configuration for mallorn-lite C header generation

language = "C"
no_includes = true

# Include version info and manually handle guards
header = """
/*
 * Mallorn-Lite: Minimal C library for edge model delta updates
 *
 * This header is auto-generated by cbindgen. Do not edit directly.
 *
 * Usage:
 *   uint8_t buffer[1024];
 *   mallorn_patcher_t patcher;
 *   mallorn_init(&patcher, buffer, sizeof(buffer));
 *   mallorn_set_source(&patcher, read_fn, source_ctx);
 *   mallorn_set_patch(&patcher, read_fn, patch_ctx);
 *   mallorn_set_output(&patcher, write_fn, output_ctx);
 *   while (mallorn_step(&patcher) == MALLORN_CONTINUE) { }
 *   mallorn_verify(&patcher, expected_hash);
 */

#ifndef MALLORN_H
#define MALLORN_H

#include <stdint.h>
#include <stddef.h>

/**
 * Opaque patcher context (256 bytes, stack-allocatable)
 *
 * Allocate this on the stack or in static memory.
 * Size is fixed and known at compile time.
 */
typedef struct mallorn_patcher_t {
    uint8_t _opaque[256];
} mallorn_patcher_t;

#define MALLORN_PATCHER_SIZE 256
"""

trailer = """
#endif /* MALLORN_H */
"""

# Style settings
style = "both"
cpp_compat = true

# Naming conventions - no crate prefix since types already have Mallorn prefix
[export]
prefix = ""
item_types = ["functions", "constants", "typedefs", "enums", "structs"]

# Only export the public FFI types (MallornPatcher is manually defined in header)
include = ["MallornResult", "MallornReadFn", "MallornWriteFn"]
exclude = ["MallornPatcher", "StreamingPatcher", "PatchHeader", "PatchFooter", "TensorOp", "PatcherState", "ReadFn", "WriteFn", "MALLORN_PATCHER_SIZE"]

[export.rename]
"MallornResult" = "mallorn_result_t"
"MallornPatcher" = "mallorn_patcher_t"
"MallornReadFn" = "mallorn_read_fn"
"MallornWriteFn" = "mallorn_write_fn"

# Enum configuration
[enum]
rename_variants = "ScreamingSnakeCase"
prefix_with_name = false

# Function configuration
[fn]
rename_args = "SnakeCase"

# Documentation
[parse]
parse_deps = false
include = []
extra_bindings = []

[parse.expand]
crates = []
